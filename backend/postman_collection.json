{
  "info": {
    "name": "Fridays - Sistema de √ìrdenes",
    "description": "Colecci√≥n de Postman para probar el flujo completo de √≥rdenes con WebSocket y actualizaciones en tiempo real\n\nüìã USUARIOS PRE-CONFIGURADOS (Password: todos123):\n- cliente@fridays.com (USER)\n- chef@fridays.com (COOK)\n- delivery@fridays.com (DISPATCHER)\n- admin@fridays.com (ADMIN)\n\nüîß CONFIGURACI√ìN INICIAL:\n1. Despu√©s de 'serverless deploy', actualiza base_url y ws_url con tus endpoints\n2. Ejecuta el script de poblaci√≥n: python backend/scripts/seed-data.py --stage dev\n3. Usa el request 'Login - Cliente' o cualquier otro para obtener el token\n4. El token se guarda autom√°ticamente en {{auth_token}}\n\nüåê WebSocket URL se obtiene del output de 'serverless deploy':\n   ServiceEndpointWebsocket: wss://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "https://k6jm5wvb0h.execute-api.us-east-1.amazonaws.com/dev",
      "type": "string",
      "description": "‚úÖ API Gateway endpoint - Ya configurado"
    },
    {
      "key": "ws_url",
      "value": "wss://i1gzzaf7nf.execute-api.us-east-1.amazonaws.com/dev",
      "type": "string",
      "description": "‚úÖ WebSocket endpoint - Ya configurado"
    },
    {
      "key": "tenant_id",
      "value": "sede-quito-001",
      "type": "string",
      "description": "TenantId de la sede principal (Quito). Creado por el script de seed"
    },
    {
      "key": "user_id",
      "value": "",
      "type": "string",
      "description": "Se auto-completa despu√©s de login"
    },
    {
      "key": "order_id",
      "value": "",
      "type": "string",
      "description": "Se auto-completa despu√©s de crear una orden"
    },
    {
      "key": "auth_token",
      "value": "",
      "type": "string",
      "description": "Se auto-completa despu√©s de login o registro"
    },
    {
      "key": "product_id",
      "value": "prod-001",
      "type": "string",
      "description": "ProductId de ejemplo (Jack Daniel's Burger). Creado por el script de seed"
    }
  ],
  "item": [
    {
      "name": "üîê 0. Autenticaci√≥n",
      "item": [
        {
          "name": "Login - Cliente (USER)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('auth_token', response.token);",
                  "    pm.collectionVariables.set('user_id', response.user.userId);",
                  "    pm.test('Login exitoso - Cliente autenticado', function() {",
                  "        pm.expect(response.token).to.exist;",
                  "        pm.expect(response.user.role).to.equal('USER');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"cliente@fridays.com\",\n  \"password\": \"todos123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "üë§ Login como cliente\n\nCredenciales:\n- Email: cliente@fridays.com\n- Password: todos123\n- Role: USER\n\nUsa esta cuenta para:\n- Crear √≥rdenes\n- Ver tu men√∫\n- Recibir notificaciones de tus pedidos"
          },
          "response": []
        },
        {
          "name": "Login - Chef (COOK)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('auth_token', response.token);",
                  "    pm.collectionVariables.set('user_id', response.user.userId);",
                  "    pm.test('Login exitoso - Chef autenticado', function() {",
                  "        pm.expect(response.token).to.exist;",
                  "        pm.expect(response.user.role).to.equal('COOK');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"chef@fridays.com\",\n  \"password\": \"todos123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "üë®‚Äçüç≥ Login como chef\n\nCredenciales:\n- Email: chef@fridays.com\n- Password: todos123\n- Role: COOK\n- TenantId: sede-quito-001\n\nUsa esta cuenta para:\n- Actualizar estado de √≥rdenes a COOKING, READY\n- Ver todas las √≥rdenes del tenant\n- Recibir notificaciones de nuevas √≥rdenes"
          },
          "response": []
        },
        {
          "name": "Login - Delivery (DISPATCHER)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('auth_token', response.token);",
                  "    pm.collectionVariables.set('user_id', response.user.userId);",
                  "    pm.test('Login exitoso - Dispatcher autenticado', function() {",
                  "        pm.expect(response.token).to.exist;",
                  "        pm.expect(response.user.role).to.equal('DISPATCHER');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"delivery@fridays.com\",\n  \"password\": \"todos123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "üöó Login como dispatcher/delivery\n\nCredenciales:\n- Email: delivery@fridays.com\n- Password: todos123\n- Role: DISPATCHER\n- TenantId: sede-quito-001\n\nUsa esta cuenta para:\n- Actualizar estado de √≥rdenes a PACKAGED, ON_THE_WAY, DELIVERED\n- Ver √≥rdenes listas para despacho\n- Recibir notificaciones de √≥rdenes listas"
          },
          "response": []
        },
        {
          "name": "Login - Admin (ADMIN)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('auth_token', response.token);",
                  "    pm.collectionVariables.set('user_id', response.user.userId);",
                  "    pm.test('Login exitoso - Admin autenticado', function() {",
                  "        pm.expect(response.token).to.exist;",
                  "        pm.expect(response.user.role).to.equal('ADMIN');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@fridays.com\",\n  \"password\": \"todos123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "üëî Login como administrador\n\nCredenciales:\n- Email: admin@fridays.com\n- Password: todos123\n- Role: ADMIN\n- TenantId: sede-quito-001\n\nUsa esta cuenta para:\n- Crear/editar productos del men√∫\n- Cambiar disponibilidad de productos\n- Ver todas las √≥rdenes y estad√≠sticas\n- Gestionar usuarios y configuraci√≥n"
          },
          "response": []
        },
        {
          "name": "‚ú® Registro de Usuario Nuevo",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201 || pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('auth_token', response.token);",
                  "    pm.collectionVariables.set('user_id', response.user.userId);",
                  "    pm.test('Usuario registrado y token guardado', function() {",
                  "        pm.expect(response.token).to.exist;",
                  "        pm.expect(response.user.userId).to.exist;",
                  "        pm.expect(response.user.role).to.equal('USER');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nuevo.cliente@test.com\",\n  \"password\": \"password123\",\n  \"firstName\": \"Juan\",\n  \"lastName\": \"P√©rez\",\n  \"phoneNumber\": \"+593987654321\",\n  \"address\": \"Av. Principal 123, Quito\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/register",
              "host": ["{{base_url}}"],
              "path": ["auth", "register"]
            },
            "description": "üìù Registra un nuevo usuario en el sistema\n\nüîí SEGURIDAD: El rol siempre es USER\nNo se puede especificar rol desde el cliente. Los roles administrativos (COOK, DISPATCHER, ADMIN) se crean desde el panel de administraci√≥n o script de seed.\n\n‚úÖ Campos requeridos:\n- email: Email √∫nico del usuario\n- password: M√≠nimo 6 caracteres\n- firstName: Nombre\n- lastName: Apellido\n\nüìã Campos opcionales:\n- phoneNumber: Tel√©fono de contacto\n- address: Direcci√≥n de entrega\n\nüéØ Retorna:\n- token: JWT para autenticaci√≥n\n- user: Informaci√≥n del usuario creado (siempre con role: USER)"
          },
          "response": []
        },
        {
          "name": "‚ö†Ô∏è [DEPRECATED] Registro de Staff",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Este endpoint est√° deprecado - usar script de seed o panel admin', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 403]);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"staff@fridays.com\",\n  \"password\": \"admin123\",\n  \"firstName\": \"Staff\",\n  \"lastName\": \"Member\",\n  \"phoneNumber\": \"+593912345678\",\n  \"role\": \"ADMIN\",\n  \"tenantId\": \"{{tenant_id}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/register",
              "host": ["{{base_url}}"],
              "path": ["auth", "register"]
            },
            "description": "‚ö†Ô∏è DEPRECADO: Este endpoint ya NO permite crear usuarios con roles administrativos.\n\nüîí SEGURIDAD: El endpoint /auth/register siempre crea usuarios con rol USER.\n\n‚úÖ Para crear usuarios staff usa:\n1. üìù Script de seed: `python backend/scripts/seed-data.py --stage dev`\n2. üëî Panel de administraci√≥n (pr√≥ximamente)\n3. üóÑÔ∏è Directamente en DynamoDB\n\nüë• Usuarios pre-configurados (password: todos123):\n- cliente@fridays.com (USER)\n- chef@fridays.com (COOK)\n- delivery@fridays.com (DISPATCHER)\n- admin@fridays.com (ADMIN)"
          },
          "response": []
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('auth_token', response.token);",
                  "    pm.collectionVariables.set('user_id', response.user.userId);",
                  "    pm.test('Login exitoso y token guardado', function() {",
                  "        pm.expect(response.token).to.exist;",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nuevouser@test.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "Login gen√©rico para usuarios creados manualmente\n\nPara usuarios pre-configurados, usa:\n- 'Login - Cliente (USER)'\n- 'Login - Chef (COOK)'\n- 'Login - Delivery (DISPATCHER)'\n- 'Login - Admin (ADMIN)'"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üçî 1. Productos (Men√∫)",
      "item": [
        {
          "name": "Listar Men√∫ (P√∫blico)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/menu?limit=20",
              "host": ["{{base_url}}"],
              "path": ["menu"],
              "query": [
                {
                  "key": "limit",
                  "value": "20"
                },
                {
                  "key": "tenantId",
                  "value": "{{tenant_id}}",
                  "disabled": true
                }
              ]
            },
            "description": "Lista todos los productos del men√∫ con paginaci√≥n. Endpoint p√∫blico, no requiere autenticaci√≥n."
          },
          "response": []
        },
        {
          "name": "Listar por Categor√≠a (P√∫blico)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/menu/FOOD",
              "host": ["{{base_url}}"],
              "path": ["menu", "FOOD"]
            },
            "description": "Lista productos filtrados por categor√≠a. Endpoint p√∫blico.\n\nCategor√≠as v√°lidas:\n- FOOD: Comida\n- DRINK: Bebidas\n- DESSERT: Postres\n- COMBO: Combos"
          },
          "response": []
        },
        {
          "name": "Crear Producto (Admin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('product_id', response.product.productId);",
                  "    pm.test('Producto creado exitosamente', function() {",
                  "        pm.expect(response.product.productId).to.exist;",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Hamburguesa Cl√°sica\",\n  \"description\": \"Hamburguesa con queso, lechuga y tomate\",\n  \"category\": \"FOOD\",\n  \"price\": 18.5,\n  \"currency\": \"PEN\",\n  \"isAvailable\": true,\n  \"preparationTimeMinutes\": 15,\n  \"imageUrl\": \"https://example.com/burger.jpg\",\n  \"tags\": [\"burger\", \"carne\", \"queso\"]\n}"
            },
            "url": {
              "raw": "{{base_url}}/menu/productos",
              "host": ["{{base_url}}"],
              "path": ["menu", "productos"]
            },
            "description": "Crea un nuevo producto en el men√∫. Requiere rol ADMIN.\n\nüîí Endpoint protegido - Requiere token JWT"
          },
          "response": []
        },
        {
          "name": "Actualizar Producto (Admin)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Hamburguesa Cl√°sica Premium\",\n  \"price\": 22.5,\n  \"description\": \"Hamburguesa premium con queso cheddar, lechuga y tomate\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/menu/items/{{product_id}}",
              "host": ["{{base_url}}"],
              "path": ["menu", "items", "{{product_id}}"]
            },
            "description": "Actualiza un producto existente. Requiere rol ADMIN.\n\nüîí Endpoint protegido - Requiere token JWT"
          },
          "response": []
        },
        {
          "name": "Cambiar Disponibilidad (Admin)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"isAvailable\": false\n}"
            },
            "url": {
              "raw": "{{base_url}}/menu/items/{{product_id}}/availability",
              "host": ["{{base_url}}"],
              "path": ["menu", "items", "{{product_id}}", "availability"]
            },
            "description": "Activa o desactiva la disponibilidad de un producto. Requiere rol ADMIN.\n\nüîí Endpoint protegido - Requiere token JWT"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üì¶ 2. Order Workflow",
      "item": [
        {
          "name": "Crear Orden (Step Functions)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Guardar orderId para usar en siguientes requests",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('order_id', response.orderId);",
                  "    pm.test('Orden creada exitosamente', function() {",
                  "        pm.expect(response.orderId).to.exist;",
                  "        pm.expect(response.status).to.equal('CREATED');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    {\n      \"productId\": \"prod-001\",\n      \"quantity\": 2\n    },\n    {\n      \"productId\": \"prod-005\",\n      \"quantity\": 2\n    }\n  ],\n  \"notes\": \"Sin cebolla en la hamburguesa, por favor\",\n  \"paymentMethod\": \"CARD\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/orders",
              "host": ["{{base_url}}"],
              "path": ["orders"]
            },
            "description": "Crea una nueva orden usando Step Functions. El workflow ejecuta:\n1. PrepareOrderData - Valida y enriquece items\n2. PersistAndBuildOrder - Guarda en DynamoDB\n3. PublishOrderCreatedEvent - Publica evento en EventBridge\n\nüîí Endpoint protegido - Requiere token JWT (rol USER)\n\nüì¶ Productos de ejemplo en seed:\n- prod-001: Jack Daniel's Burger ($12.99)\n- prod-002: Costillas BBQ ($18.50)\n- prod-003: Alitas Picantes ($10.99)\n- prod-005: Margarita Cl√°sica ($7.50)\n- prod-006: Limonada Natural ($3.50)\n\nNOTA: El userId y tenantId se extraen autom√°ticamente del JWT token"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üîÑ 3. Update Order Status",
      "item": [
        {
          "name": "Actualizar a COOKING",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Estado actualizado a COOKING', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.newStatus).to.equal('COOKING');",
                  "    pm.expect(response.previousStatus).to.equal('CREATED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"COOKING\",\n  \"notes\": \"Asignado a estaci√≥n de parrilla\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/orders/{{tenant_id}}/{{order_id}}/status",
              "host": ["{{base_url}}"],
              "path": ["orders", "{{tenant_id}}", "{{order_id}}", "status"]
            },
            "description": "El cocinero actualiza el estado de la orden a COOKING. Este endpoint:\n1. Actualiza el estado en DynamoDB\n2. Publica evento ORDER_STATUS_CHANGED en EventBridge\n3. El evento dispara la Lambda broadcast que notifica a usuarios conectados v√≠a WebSocket\n\nüîí Endpoint protegido - Requiere token JWT con rol COOK, DISPATCHER o ADMIN"
          },
          "response": []
        },
        {
          "name": "Actualizar a READY",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"READY\",\n  \"notes\": \"Listo para empaquetar\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/orders/{{tenant_id}}/{{order_id}}/status",
              "host": ["{{base_url}}"],
              "path": ["orders", "{{tenant_id}}", "{{order_id}}", "status"]
            },
            "description": "El cocinero marca la orden como lista para empaquetar"
          },
          "response": []
        },
        {
          "name": "Actualizar a PACKAGED",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"PACKAGED\",\n  \"notes\": \"Empaquetado y listo para despacho\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/orders/{{tenant_id}}/{{order_id}}/status",
              "host": ["{{base_url}}"],
              "path": ["orders", "{{tenant_id}}", "{{order_id}}", "status"]
            },
            "description": "El empaquetador marca la orden como empaquetada"
          },
          "response": []
        },
        {
          "name": "Actualizar a ON_THE_WAY",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"ON_THE_WAY\",\n  \"notes\": \"En camino al cliente\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/orders/{{tenant_id}}/{{order_id}}/status",
              "host": ["{{base_url}}"],
              "path": ["orders", "{{tenant_id}}", "{{order_id}}", "status"]
            },
            "description": "El repartidor recoge la orden y la marca como en camino"
          },
          "response": []
        },
        {
          "name": "Actualizar a DELIVERED",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"DELIVERED\",\n  \"notes\": \"Entregado al cliente\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/orders/{{tenant_id}}/{{order_id}}/status",
              "host": ["{{base_url}}"],
              "path": ["orders", "{{tenant_id}}", "{{order_id}}", "status"]
            },
            "description": "El repartidor marca la orden como entregada. Esta es una acci√≥n final que marca resolvedAt"
          },
          "response": []
        },
        {
          "name": "Actualizar a CANCELLED",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"CANCELLED\",\n  \"notes\": \"Cancelado por solicitud del cliente\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/orders/{{tenant_id}}/{{order_id}}/status",
              "host": ["{{base_url}}"],
              "path": ["orders", "{{tenant_id}}", "{{order_id}}", "status"]
            },
            "description": "Cancela la orden. Esta es una acci√≥n final que marca resolvedAt"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üåê 4. WebSocket Connection",
      "item": [
        {
          "name": "Conectar WebSocket (Usuario)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{ws_url}}?userId={{user_id}}&tenantId={{tenant_id}}&role=USER",
              "host": ["{{ws_url}}"],
              "query": [
                {
                  "key": "userId",
                  "value": "{{user_id}}"
                },
                {
                  "key": "tenantId",
                  "value": "{{tenant_id}}"
                },
                {
                  "key": "role",
                  "value": "USER"
                }
              ]
            },
            "description": "Conecta al WebSocket como usuario cliente.\n\nüåê URL WebSocket:\nDespu√©s de 'serverless deploy', copia el endpoint:\n  ServiceEndpointWebsocket: wss://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev\n\nY actualiza la variable {{ws_url}} en Postman\n\n‚ö° C√≥mo probar WebSocket:\n\n1. En Postman:\n   - New Request ‚Üí WebSocket\n   - URL: {{ws_url}}?userId={{user_id}}&tenantId={{tenant_id}}&role=USER\n   - Click 'Connect'\n   - Los mensajes llegar√°n cuando se actualice el estado de una orden\n\n2. C√≥digo JavaScript para el frontend:\n\n```javascript\nconst userId = 'user-001'; // Del JWT\nconst tenantId = 'sede-quito-001';\nconst role = 'USER';\n\nconst ws = new WebSocket(\n  `wss://YOUR_WS_ID.execute-api.us-east-1.amazonaws.com/dev?userId=${userId}&tenantId=${tenantId}&role=${role}`\n);\n\nws.onopen = () => console.log('‚úÖ Conectado al WebSocket');\n\nws.onmessage = (event) => {\n  const notification = JSON.parse(event.data);\n  console.log('üì¨ Nueva notificaci√≥n:', notification);\n  \n  // Mostrar notificaci√≥n al usuario\n  if (notification.type === 'ORDER_STATUS_CHANGED') {\n    alert(`${notification.message} - Estado: ${notification.status}`);\n  }\n};\n\nws.onerror = (error) => console.error('‚ùå Error:', error);\nws.onclose = () => console.log('üîå Desconectado');\n```\n\nMensajes esperados:\n- ORDER_CREATED: Cuando se crea una orden\n- ORDER_STATUS_CHANGED: Cuando cambia el estado de una orden"
          },
          "response": []
        },
        {
          "name": "Conectar WebSocket (Staff)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{ws_url}}?userId=cook-001&tenantId={{tenant_id}}&role=COOK",
              "host": ["{{ws_url}}"],
              "query": [
                {
                  "key": "userId",
                  "value": "cook-001"
                },
                {
                  "key": "tenantId",
                  "value": "{{tenant_id}}"
                },
                {
                  "key": "role",
                  "value": "COOK"
                }
              ]
            },
            "description": "Conecta al WebSocket como staff (cocinero, despachador, admin).\n\nüë®‚Äçüç≥ El staff recibe:\n- Todas las nuevas √≥rdenes del tenant (ORDER_CREATED)\n- Todas las actualizaciones de estado del tenant (ORDER_STATUS_CHANGED)\n\nüîë UserIds del staff (del seed):\n- cook-001 (chef@fridays.com)\n- cook-002 (chef2@fridays.com)\n- dispatcher-001 (delivery@fridays.com)\n- admin-001 (admin@fridays.com)\n\nRoles v√°lidos: USER, COOK, DISPATCHER, ADMIN"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üí¨ 5. Ejemplos de Respuestas WebSocket",
      "item": [
        {
          "name": "Ejemplo ORDER_CREATED",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost/example",
              "protocol": "http",
              "host": ["localhost"],
              "path": ["example"]
            },
            "description": "Este es un ejemplo del mensaje que recibir√°s en el WebSocket cuando se crea una orden:\n\n```json\n{\n  \"type\": \"ORDER_CREATED\",\n  \"orderId\": \"uuid-orden\",\n  \"status\": \"CREATED\",\n  \"message\": \"‚úÖ Tu pedido ha sido confirmado\",\n  \"timestamp\": \"2025-11-22T10:30:00Z\",\n  \"data\": {\n    \"orderId\": \"uuid-orden\",\n    \"tenantId\": \"TENANT#001\",\n    \"status\": \"CREATED\",\n    \"total\": 55.5,\n    \"items\": [\n      {\n        \"productId\": \"PRODUCT#001\",\n        \"name\": \"Hamburguesa Cl√°sica\",\n        \"quantity\": 2,\n        \"unitPrice\": 18.5,\n        \"subtotal\": 37.0\n      }\n    ]\n  }\n}\n```"
          },
          "response": []
        },
        {
          "name": "Ejemplo ORDER_STATUS_CHANGED",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost/example",
              "protocol": "http",
              "host": ["localhost"],
              "path": ["example"]
            },
            "description": "Este es un ejemplo del mensaje que recibir√°s en el WebSocket cuando cambia el estado:\n\n```json\n{\n  \"type\": \"ORDER_STATUS_CHANGED\",\n  \"orderId\": \"uuid-orden\",\n  \"status\": \"COOKING\",\n  \"message\": \"üë®‚Äçüç≥ Tu pedido est√° en preparaci√≥n\",\n  \"timestamp\": \"2025-11-22T10:35:00Z\",\n  \"data\": {\n    \"orderId\": \"uuid-orden\",\n    \"tenantId\": \"TENANT#001\",\n    \"status\": \"COOKING\",\n    \"previousStatus\": \"CREATED\",\n    \"changedBy\": \"COOK#456\",\n    \"total\": 55.5,\n    \"items\": [...]\n  }\n}\n```\n\nMensajes seg√∫n el estado:\n- CREATED: ‚úÖ Tu pedido ha sido confirmado\n- COOKING: üë®‚Äçüç≥ Tu pedido est√° en preparaci√≥n\n- READY: üîî Tu pedido est√° listo\n- PACKAGED: üì¶ Tu pedido est√° siendo empaquetado\n- ON_THE_WAY: üöó Tu pedido est√° en camino\n- DELIVERED: üéâ ¬°Pedido entregado! ¬°Disfruta!\n- CANCELLED: ‚ùå Tu pedido ha sido cancelado"
          },
          "response": []
        }
      ]
    }
  ]
}

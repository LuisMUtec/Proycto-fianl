service: fridays-delivery-service

frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs20.x
  region: us-east-1
  stage: ${opt:stage, 'dev'}
  
  # ⚠️ AWS ACADEMY: Usar LabRole
  iam:
    role: arn:aws:iam::085179068256:role/LabRole
  
  environment:
    STAGE: ${self:provider.stage}
    REGION: us-east-1
    ORDERS_TABLE: Orders-${self:provider.stage}
    DRIVERS_TABLE: Drivers-${self:provider.stage}
    EVENT_BUS_NAME: fridays-event-bus-${self:provider.stage}

# Configurar empaquetado para incluir shared
package:
  patterns:
    - 'functions/**'
    - 'shared/**'
    - '!shared/**/*.test.js'
    - '!**/*.md'

functions:
  getDriver:
    handler: functions/drivers/getDriver.handler
    events:
      - http:
          path: /delivery/drivers/{driverId}
          method: GET
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST

  listDrivers:
    handler: functions/drivers/listDrivers.handler
    events:
      - http:
          path: /delivery/drivers
          method: GET
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST

  getAvailableDrivers:
    handler: functions/drivers/getAvailable.handler
    events:
      - http:
          path: /delivery/drivers/available
          method: GET
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST

  assignDelivery:
    handler: functions/orders/assignDelivery.handler
    events:
      - http:
          path: /delivery/orders/{orderId}/assign
          method: POST
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST

  listOrders:
    handler: functions/orders/listOrders.handler
    events:
      - http:
          path: /delivery/orders
          method: GET
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST

  getOrder:
    handler: functions/orders/getOrder.handler
    events:
      - http:
          path: /delivery/orders/{orderId}
          method: GET
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST

  deleteOrder:
    handler: functions/orders/deleteOrder.handler
    events:
      - http:
          path: /delivery/orders/{orderId}
          method: DELETE
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST

  getTracking:
    handler: functions/orders/getTracking.handler
    events:
      - http:
          path: /delivery/orders/{orderId}/tracking
          method: GET
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST
  authorizer:
    handler: shared/auth/authorizer.handler
  updateDriver:
    handler: functions/drivers/updateDriver.handler
    events:
      - http:
          path: /delivery/drivers/{driverId}
          method: PUT
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST

  deleteDriver:
    handler: functions/drivers/deleteDriver.handler
    events:
      - http:
          path: /delivery/drivers/{driverId}
          method: DELETE
          cors: true
          authorizer:
            name: authorizer
            type: REQUEST

plugins:
  - serverless-offline
